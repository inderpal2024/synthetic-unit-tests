<!DOCTYPE html>
<html>
<head>
  <title>Food Preference Ranking</title>
  <style>
    body {
      font-family: sans-serif;
    }
    h1 {
      text-align: center;
    }
    .choice-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .choice {
      padding: 10px 20px;
      margin: 0 10px;
      border: 1px solid #ccc;
      cursor: pointer;
      border-radius: 5px;
    }
    .choice:hover {
      background-color: #eee;
    }
    #results {
      margin-top: 20px;
      text-align: center; /* Center the results */
    }
    ol {
      width: max-content;
      margin-left: auto;
      margin-right: auto;
    }
    li {
      text-align: left;
    }
    #comparison-counter {
      text-align: center;
      margin: 10px auto;
      max-width: max-content;
      padding: 5px 10px;
    }
  </style>
</head>
<body>

<h1>Food Preference Ranking</h1>

<div id="choice-container" class="choice-container"></div>
<div id="comparison-counter">
  Comparisons Remaining: <span id="comparisons-remaining"></span>
</div>
<div id="results"></div>

<script>
  var foods = [
    "Clam Chowder", "California Burrito", "Mission-style Burrito", "Fish Tacos", "Carne Asada Fries", "Date Shake",
    "Avocado Toast", "Sourdough Bread", "Tri-tip Sandwich", "cioppino" // Example local foods (adjust as needed)
  ];

  var eloScores = {};
  foods.forEach(food => eloScores[food] = 1000); // Initialize ELO scores

  function updateElo(winner, loser) { console.log('updating elo', winner, loser);
    const k = 32; // ELO K-factor
    const expectedScoreWinner = 1 / (1 + Math.pow(10, (eloScores[loser] - eloScores[winner]) / 400));
    const expectedScoreLoser = 1 / (1 + Math.pow(10, (eloScores[winner] - eloScores[loser]) / 400));

    eloScores[winner] += k * (1 - expectedScoreWinner);
    eloScores[loser] += k * (0 - expectedScoreLoser);
  }

  var comparisonsRemaining = 15;
  const comparisonCount = document.getElementById('comparisons-remaining');

  function displayChoices(food1, food2) {
    const container = document.getElementById("choice-container");
    container.innerHTML = ""; // Clear previous choices

    const choice1 = document.createElement("div");
    choice1.className = "choice";
    choice1.textContent = food1;
    choice1.onclick = () => handleChoice(food1, food2);
    container.appendChild(choice1);

    const choice2 = document.createElement("div");
    choice2.className = "choice";
    choice2.textContent = food2;
    choice2.onclick = () => handleChoice(food2, food1);
    container.appendChild(choice2);

    comparisonCount.textContent = comparisonsRemaining;
  }

  function displayResults() {
    const sortedFoods = Object.entries(eloScores).sort(([, scoreA], [, scoreB]) => scoreB - scoreA);
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "<h2>Your Food Ranking:</h2>";
    const resultList = document.createElement("ol");
    sortedFoods.forEach(([food, score]) => {
      const listItem = document.createElement("li"),
        span1 = document.createElement('span'),
        span2 = document.createElement('span');

      span1.textContent = food;
      span2.textContent = Math.round(score);
      span1.style.marginRight = '10px';

      listItem.appendChild(span1);
      listItem.appendChild(span2);
      resultList.appendChild(listItem);
    });
    resultsDiv.appendChild(resultList);
  }

  function handleChoice(winner, loser) {
    updateElo(winner, loser);
    comparisonsRemaining--;

    if (comparisonsRemaining > 0) { // Adjust the number of comparisons as needed
      const {food1, food2} = pick2RandomFoods();

      displayChoices(food1, food2);
    } else {
      const container = document.getElementById("choice-container");
      container.innerHTML = ""; // Clear existing choices

      document.getElementById('comparison-counter').style.display = 'none';

      displayResults();
    }
  }

  function pick2RandomFoods() {
    const food1 = foods[Math.floor(Math.random() * foods.length)];
    let food2;

    do {
      food2 = foods[Math.floor(Math.random() * foods.length)];
    } while (food1 === food2);

    return { food1, food2 };
  }

  const {food1, food2} = pick2RandomFoods();
  displayChoices(food1, food2);

</script>

</body>
</html>
